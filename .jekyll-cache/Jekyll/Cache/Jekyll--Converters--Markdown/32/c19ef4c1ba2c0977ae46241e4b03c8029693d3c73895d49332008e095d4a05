I"ê<ol>
  <li>Install <code class="highlighter-rouge">ipset</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>ipset
</code></pre></div>    </div>
  </li>
  <li>Create new <em>ipset</em>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ipset create tor iphash
</code></pre></div>    </div>
  </li>
  <li>Read Tor Exit Node List and add to <em>ipset</em>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sSL</span> <span class="s2">"https://check.torproject.org/cgi-bin/TorBulkExitList.py?ip=</span><span class="si">$(</span>curl icanhazip.com<span class="si">)</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'/^#/d'</span> | <span class="k">while </span><span class="nb">read </span>IP<span class="p">;</span> <span class="k">do
</span>ipset <span class="nt">-q</span> <span class="nt">-A</span> tor <span class="nv">$IP</span>
<span class="k">done</span>
</code></pre></div>    </div>
    <blockquote>
      <p><strong>Note</strong>: This should run as daily cronjob!</p>
    </blockquote>
  </li>
  <li>Block <em>ipset</em> with <code class="highlighter-rouge">iptables</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> <span class="nb">set</span> <span class="nt">--match-set</span> tor src <span class="nt">-j</span> DROP
</code></pre></div>    </div>
  </li>
</ol>

<hr />
<ol>
  <li><a href="http://mikhailian.mova.org/node/194">http://mikhailian.mova.org/node/194</a></li>
</ol>
:ET