I" <h2 id="prerequirements">Prerequirements</h2>
<h3 id="dns">DNS</h3>
<p>The server’s IP needs a valid DNS record, available in the Active Directory environment.</p>

<h3 id="apache">Apache</h3>
<p>Apache needs to be configured and running before setting up Kerberos.</p>

<h3 id="keytab">Keytab</h3>
<blockquote>
  <p>The Kerberos Keytab file needs to be generated on a domain controller and transfered to the Debian server afterwards.</p>
</blockquote>

<ol>
  <li>Create unprivileged Active Directory user (<code class="highlighter-rouge">&lt;$BIND_USER&gt;</code>).</li>
  <li>Generate Keytab:
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">ktpass</span><span class="w"> </span><span class="nt">-princ</span><span class="w"> </span><span class="nx">HTTP/test.example.org</span><span class="err">@</span><span class="nx">EXAMPLE.ORG</span><span class="w"> </span><span class="nt">-mapuser</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">$BIND_USER</span><span class="err">&gt;@</span><span class="nx">EXAMPLE.ORG</span><span class="w"> </span><span class="nt">-pass</span><span class="w"> </span><span class="s2">"&lt;</span><span class="nv">$BIND_PASSWORD</span><span class="s2">&gt;"</span><span class="w"> </span><span class="nt">-crypto</span><span class="w"> </span><span class="nx">ALL</span><span class="w"> </span><span class="nt">-ptype</span><span class="w"> </span><span class="nx">KRB5_NT_PRINCIPAL</span><span class="w"> </span><span class="nt">-out</span><span class="w"> </span><span class="nx">c:\krb5.keytab</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Transfer the keytab file to <code class="highlighter-rouge">/etc/krb5.keytab</code> on the Debian server.</li>
</ol>

<h3 id="packages">Packages</h3>
<p>Install the reuqired packages on the Debian server:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update
apt <span class="nb">install</span> <span class="nt">-y</span> libapache2-mod-auth-kerb krb5-user
</code></pre></div></div>

<h2 id="server-configuration">Server Configuration</h2>
<h3 id="kerberos">Kerberos</h3>
<p>Edit <code class="highlighter-rouge">/etc/krb5.conf</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[libdefaults]
default_realm = EXAMPLE.ORG
		 
[realms]
EXAMPLE.ORG = {
	kdc = dc.example.org
	admin_server = dc.example.org
}

[domain_realm]
.example.org = EXAMPLE.ORG
example.org = EXAMPLE.ORG
</code></pre></div></div>

<h3 id="apache-1">Apache</h3>
<p>Edit the virtual host’s config:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:443&gt;
  ServerName test.example.org
  ...

  &lt;Location /&gt;
    AuthType Kerberos
    AuthName "Kerberos Authorization"
    KrbMethodNegotiate on
    KrbMethodK5Passwd on
    KrbAuthoritative on
    KrbAuthRealms EXAMPLE.ORG
    KrbVerifyKDC off
    Krb5Keytab /etc/krb5.keytab
    KrbServiceName HTTP/test.example.org@EXAMPLE.ORG
    require valid-user
  &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></pre></div></div>

<h2 id="client-configuration">Client Configuration</h2>
<p>See <a href="/sso-macos-kerberos/">Kerberos Authentication on macOS (SSO)</a>.</p>

<hr />
:ET