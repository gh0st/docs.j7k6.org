I"É<p>This coveres a basic  <em>Ubiquity</em> <strong><em>EdgeRouter Lite/X</em></strong> setup with a WAN connection on <code class="highlighter-rouge">eth0</code> and a LAN site on <code class="highlighter-rouge">eth1</code>, including <em>Firewall</em>, <em>NAT</em>, <em>DHCP</em> &amp; <em>DNS</em>.</p>

<p>A brand new <em>EdgeRouter</em> can be accessed on itâ€™s <code class="highlighter-rouge">eth0</code> interface on the default IP address <code class="highlighter-rouge">192.168.1.1</code>. To do the basic configuration, connect to it via SSH (default username/password: <code class="highlighter-rouge">ubnt</code>/<code class="highlighter-rouge">ubnt</code>). Type <code class="highlighter-rouge">configure</code> to enter configuration mode.</p>

<hr />

<h2 id="firewall">Firewall</h2>
<h3 id="basic-rules">Basic rules</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set firewall all-ping enable
set firewall broadcast-ping disable
set firewall ipv6-receive-redirects disable
set firewall ipv6-src-route disable
set firewall ip-src-route disable
set firewall log-martians enable
set firewall receive-redirects disable
set firewall send-redirects enable
set firewall source-validation disable
set firewall syn-cookies enable
</code></pre></div></div>

<h3 id="incoming-wan-rules">Incoming WAN rules</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set firewall name WAN_IN default-action drop
set firewall name WAN_IN enable-default-log
set firewall name WAN_IN rule 1 action accept
set firewall name WAN_IN rule 1 description "Allow established connections"
set firewall name WAN_IN rule 1 state established enable
set firewall name WAN_IN rule 1 state related enable
set firewall name WAN_IN rule 2 action drop
set firewall name WAN_IN rule 2 log enable
set firewall name WAN_IN rule 2 description "Drop invalid state"
set firewall name WAN_IN rule 2 state invalid enable
</code></pre></div></div>

<h3 id="wan-to-lan-rules">WAN to LAN rules</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set firewall name WAN_LOCAL default-action drop
set firewall name WAN_LOCAL enable-default-log
set firewall name WAN_LOCAL rule 1 action accept
set firewall name WAN_LOCAL rule 1 description "Allow established connections"
set firewall name WAN_LOCAL rule 1 state established enable
set firewall name WAN_LOCAL rule 1 state related enable
set firewall name WAN_LOCAL rule 2 action drop
set firewall name WAN_LOCAL rule 2 log enable
set firewall name WAN_LOCAL rule 2 description "Drop invalid state"
set firewall name WAN_LOCAL rule 2 state invalid enable
</code></pre></div></div>

<hr />

<h2 id="interfaces">Interfaces</h2>
<h3 id="wan-interface">WAN Interface</h3>
<p>The WAN interface will get its IP from an external DHCP (cable modem or so):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set interfaces ethernet eth0 description WAN
set interfaces ethernet eth0 address dhcp
set interfaces ethernet eth0 dhcp-options name-server no-update
set interfaces ethernet eth0 firewall in name WAN_IN
set interfaces ethernet eth0 firewall local name WAN_LOCAL
</code></pre></div></div>

<h3 id="lan-interface">LAN Interface</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set interfaces ethernet eth1 description LAN1
set interfaces ethernet eth1 address 192.168.1.254/24
</code></pre></div></div>

<hr />

<h2 id="nat">NAT</h2>
<p>The outgoing traffic from the LAN interface needs to be masqueraded (Source-NAT):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set service nat rule 5010 description "Masquerade for WAN"
set service nat rule 5010 outbound-interface eth0
set service nat rule 5010 type masquerade
</code></pre></div></div>

<hr />

<h2 id="dhcp">DHCP</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set service dhcp-server disabled false
set service dhcp-server shared-network-name LAN1 authoritative enable
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 default-router 192.168.1.254
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 dns-server 192.168.1.254
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 lease 86400
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 start 192.168.1.100 stop 192.168.1.200
</code></pre></div></div>

<hr />

<h2 id="dns">DNS</h2>
<p>Use <code class="highlighter-rouge">dnsmasq</code> as DNS forwarder:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set system name-server 127.0.0.1
set service dns forwarding options strict-order
set service dns forwarding name-server 1.1.1.1
set service dns forwarding name-server 8.8.8.8
set service dns forwarding listen-on eth1
</code></pre></div></div>

<hr />

<p>To finish the basic setup, run those commands:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>commit
save
exit
</code></pre></div></div>

<hr />
<ol>
  <li><a href="https://loganmarchione.com/2016/04/ubiquiti-edgerouter-lite-setup/">https://loganmarchione.com/2016/04/ubiquiti-edgerouter-lite-setup/</a></li>
</ol>
:ET