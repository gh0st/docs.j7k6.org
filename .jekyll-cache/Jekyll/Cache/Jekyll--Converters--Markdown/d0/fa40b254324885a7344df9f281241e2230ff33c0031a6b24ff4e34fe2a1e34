I"∏<blockquote>
  <p>This is based on <a href="/sso-apache-kerberos-debian/">‚ÄúSSO with Apache and Kerberos on Debian‚Äù</a>. All prerequirements and configuration steps are the same, except the Apache parts. This only covers the Nginx parts of the process!</p>
</blockquote>

<h2 id="prerequirements">Prerequirements</h2>
<p>Nginx doesn‚Äôt has build-in support for Kerberos Authentication, but there is a third-party <a href="https://github.com/stnoonan/spnego-http-auth-nginx-module">SPNEGO HTTP Authentication Module</a> that can be compiled as a dynamic module.</p>

<ol>
  <li>Install required packages:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update
apt <span class="nb">install</span> <span class="nt">-y</span> build-essential <span class="se">\</span>
  curl <span class="se">\</span>
  git <span class="se">\</span>
  libkrb5-dev <span class="se">\</span>
  libpcre3-dev <span class="se">\</span>
  libssl-dev <span class="se">\</span>
  libxml2-dev <span class="se">\</span>
  libxslt1-dev <span class="se">\</span>
  libgd-dev <span class="se">\</span>
  libgeoip-dev <span class="se">\</span>
  zlib1g-dev
</code></pre></div>    </div>
  </li>
  <li>Clone the <em>SPNEGO HTTP Authentication Module</em> Git repo:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/stnoonan/spnego-http-auth-nginx-module
</code></pre></div>    </div>
  </li>
  <li>Download &amp; extract the Nginx source code (get installed version with <code class="highlighter-rouge">nginx -v</code>, e.g. <em>1.14.2</em>):
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-fsSL</span> https://nginx.org/download/nginx-&lt;<span class="nv">$NGINX_VERSION</span><span class="o">&gt;</span>.tar.gz | <span class="nb">tar </span>zxf -
<span class="nb">cd </span>nginx-&lt;<span class="nv">$NGINX_VERSION</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>Get all build flags of the currently installed Nginx binary by running <code class="highlighter-rouge">nginx -V</code>. Copy the <em>configure arguments</em> (<strong>without</strong> <code class="highlighter-rouge">--add-dynamic-module=...</code> flags!).</li>
  <li>Run <code class="highlighter-rouge">configure</code> script with the copied build flags:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure &lt;<span class="nv">$NGINX_BUILD_FLAGS</span><span class="o">&gt;</span> <span class="nt">--add-dynamic-module</span><span class="o">=</span>../spnego-http-auth-nginx-module
</code></pre></div>    </div>
  </li>
  <li>Compile modules:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make modules
</code></pre></div>    </div>
  </li>
  <li>Copy module:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp </span>objs/ngx_http_auth_spnego_module.so /usr/lib/nginx/modules/
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="configuration">Configuration</h2>
<ol>
  <li>Add this line before the <code class="highlighter-rouge">http</code> part of <code class="highlighter-rouge">/etc/nginx/nginx.conf</code>:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>load_module /usr/lib/nginx/modules/ngx_http_auth_spnego_module.so;
</code></pre></div>    </div>
  </li>
  <li>Add <code class="highlighter-rouge">auth_gss</code> parameters to the site config:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server {
  server_name test.example.org;
  listen 443 ssl;
  ...

  location / {
    auth_gss on;
    auth_gss_realm EXAMPLE.ORG;
    auth_gss_service_name "HTTP/test.example.org";
    auth_gss_keytab /etc/krb5.keytab;
  }
}
</code></pre></div>    </div>
  </li>
</ol>

<hr />
:ET