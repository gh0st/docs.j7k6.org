I"Ý
<h2 id="firewall">Firewall</h2>
<p>Before sending mail, SMTP port 25 has to be opened in the ESXi firewall for outgoing connections.</p>

<ol>
  <li>Edit <code class="highlighter-rouge">/etc/vmware/firewall/smtp.xml</code>:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ConfigRoot&gt;
  &lt;service id='2525'&gt;
    &lt;id&gt;SMTP_Out&lt;/id&gt;
    &lt;rule id='0000'&gt;
      &lt;direction&gt;outbound&lt;/direction&gt;
      &lt;protocol&gt;tcp&lt;/protocol&gt;
      &lt;porttype&gt;dst&lt;/porttype&gt;
      &lt;port&gt;25&lt;/port&gt;
    &lt;/rule&gt;
    &lt;enabled&gt;true&lt;/enabled&gt;
    &lt;required&gt;false&lt;/required&gt;
  &lt;/service&gt;
&lt;/ConfigRoot&gt;
</code></pre></div>    </div>
  </li>
  <li>Reload firewall rules:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esxcli network firewall refresh
</code></pre></div>    </div>
  </li>
  <li>Make firewall rules persistent:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +t /etc/vmware/firewall/smtp.xml
/bin/auto-backup.sh
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="send-mail">Send Mail</h2>
<blockquote>
  <p><strong>Note</strong>: The mail server needs to support unencrypted SMTP on port 25! Authentication is possible, but not necessary if you control both servers, just whitelist the ESXiâ€™s IP for sending unauthenticated mail.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\</span><span class="s2">
  EHLO localhost</span><span class="se">\n\</span><span class="s2">
  MAIL FROM: &lt;</span><span class="nv">$SENDER_ADDRESS</span><span class="s2">&gt;</span><span class="se">\n\</span><span class="s2">
  RCPT TO: &lt;</span><span class="nv">$RCPT_ADDRESS</span><span class="s2">&gt;</span><span class="se">\n\</span><span class="s2">
  DATA</span><span class="se">\n\</span><span class="s2">
  From: &lt;</span><span class="nv">$SENDER_ADDRESS</span><span class="s2">&gt;</span><span class="se">\n\</span><span class="s2">
  Subject: &lt;</span><span class="nv">$SUBJECT</span><span class="s2">&gt;</span><span class="se">\n\</span><span class="s2">
  &lt;</span><span class="nv">$MAIL_BODY</span><span class="s2">&gt;</span><span class="se">\n\n\</span><span class="s2">
  .</span><span class="se">\n\</span><span class="s2">
  quit</span><span class="se">\n</span><span class="s2">"</span> <span class="se">\</span>
| nc &lt;<span class="nv">$MAIL_SERVER</span><span class="o">&gt;</span> 25
</code></pre></div></div>

<hr />
:ET