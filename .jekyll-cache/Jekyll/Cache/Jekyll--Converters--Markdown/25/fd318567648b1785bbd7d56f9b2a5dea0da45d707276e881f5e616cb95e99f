I"]<h2 id="scenario">Scenario</h2>
<p>A static website is hosted on <em>Github Pages</em> and is SSL-terminated
by Cloudflare. it can take some time until the Cloudflare cache is regenerated,
so the changes to the website are not publicly available right after a push to the repository.</p>

<h2 id="solution">Solution</h2>
<p>Add a local Git hook to reset the Cloudflare Cache on every push to the repo. Edit <code class="highlighter-rouge">.git/hooks/post-receive</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="nb">export </span><span class="nv">CLOUDFLARE_AUTH_EMAIL</span><span class="o">=</span><span class="s2">"&lt;</span><span class="nv">$EMAIL</span><span class="s2">&gt;"</span>
<span class="nb">export </span><span class="nv">CLOUDFLARE_API_KEY</span><span class="o">=</span><span class="s2">"&lt;</span><span class="nv">$API_KEY</span><span class="s2">&gt;"</span>
<span class="nb">export </span><span class="nv">CLOUDFLARE_ZONE_ID</span><span class="o">=</span><span class="s2">"&lt;</span><span class="nv">$ZONE_ID</span><span class="s2">&gt;"</span>

<span class="nb">sleep </span>10

curl <span class="nt">-X</span> DELETE <span class="s2">"https://api.cloudflare.com/client/v4/zones/</span><span class="k">${</span><span class="nv">CLOUDFLARE_ZONE_ID</span><span class="k">}</span><span class="s2">/purge_cache"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"X-Auth-Email: </span><span class="k">${</span><span class="nv">CLOUDFLARE_AUTH_EMAIL</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"X-Auth-Key: </span><span class="k">${</span><span class="nv">CLOUDFLARE_API_KEY</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">--data</span> <span class="s1">'{"purge_everything":true}'</span>

<span class="nb">exit </span>0
</code></pre></div></div>

<hr />
:ET